services:
  # Build the Matter-enabled firmware inside the ESP-IDF + ESP-Matter container.
  # Usage: docker compose run --build build
  build:
    build:
      context: ./
      dockerfile: Dockerfile
      target: builder
    volumes:
      - ./:/app
    command: >-
      bash -c "idf.py set-target esp32c5
      && idf.py build
      && cd build
      && esptool.py --chip esp32c5 merge_bin
      --flash_mode dio --flash_size 4MB
      -o moto.bin @flash_args"

  clean:
    build:
      context: ./
      dockerfile: Dockerfile
      target: builder
    volumes:
      - ./:/app
    command: idf.py fullclean
